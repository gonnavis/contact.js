<!DOCTYPE html>
<html>
  <head>
	<title>Touch Receiver Test</title>
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<style type="text/css">
		body { margin: 0px; overflow: hidden; }
	</style>
</head>
<body>
    <script src="src/wire.js"></script>
	<script src="src/connection.js"></script>
	<script src="src/receiver.js"></script>

    <script>
        var canvas = document.createElement('canvas');
        canvas.width = innerWidth;
        canvas.height = innerHeight;

        document.body.appendChild(canvas);

        ctx = canvas.getContext('2d');

        function Counter() {
            this.data = [];
        }

        Counter.prototype.push = function(d) {
            this.data.push(d);
            if (this.data.length > 800) this.data.shift();
        }

        var dm_x = new Counter();
        var dm_y = new Counter();
        var dm_z = new Counter();

        var dm_a = new Counter();
        var dm_b = new Counter();
        var dm_g = new Counter();

        var do_a = new Counter();
        var do_b = new Counter();
        var do_g = new Counter();


        function onDm(x, y, z, a, b, g) {
            dm_x.push(x);
            dm_y.push(y);
            dm_z.push(z);
            dm_a.push(a / 90);
            dm_b.push(b / 90);
            dm_g.push(g / 90);
        }

        function onDo(a, b, g) {
            do_a.push(a / 15);
            do_b.push(b / 15);
            do_g.push(g / 15);
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(10, 0);
            
            renderUnit(dm_x);
            renderUnit(dm_y);
            renderUnit(dm_z);

            renderUnit(dm_a);
            renderUnit(dm_b);
            renderUnit(dm_g);

            renderUnit(do_a);
            renderUnit(do_b);
            renderUnit(do_g);

            ctx.restore();

            requestAnimationFrame(render);
        }

        function renderUnit(unit) {
            ctx.translate(0, 50);
            ctx.beginPath();
            if (unit.data.length) ctx.moveTo(0, unit.data[0]);
            for (var i = 0; i < unit.data.length; i++) {
                ctx.lineTo(i, unit.data[i]);
            }
            ctx.stroke();
        }

        render();

    </script>
</body>
</html>